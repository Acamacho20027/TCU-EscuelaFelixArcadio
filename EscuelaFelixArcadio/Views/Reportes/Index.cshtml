
@{
    ViewBag.Title = "Reportes";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

@section Styles {
    <link href="~/Content/reportes.css?v=3.5" rel="stylesheet" />
}

<div class="reportes-container">
    <!-- Header Principal -->
    <div class="reportes-header">
        <h1 class="reportes-title">@ViewBag.Title</h1>
    </div>

    <!-- Alertas Recientes -->
    @if (ViewBag.AlertasRecientes != null && ((List<EscuelaFelixArcadio.Models.AlertaReporte>)ViewBag.AlertasRecientes).Any())
    {
        <div class="alertas-container">
            <div class="filtros-header">
                <i class="fas fa-exclamation-triangle filtros-icon"></i>
                <h3>Alertas Recientes</h3>
            </div>
            @foreach (var alerta in (List<EscuelaFelixArcadio.Models.AlertaReporte>)ViewBag.AlertasRecientes)
            {
                <div class="alerta-item @alerta.Severidad.ToLower()">
                    <i class="fas fa-exclamation-circle alerta-icon"></i>
                    <div class="alerta-content">
                        <div class="alerta-titulo">@alerta.TipoAlerta</div>
                        <div class="alerta-descripcion">@alerta.Descripcion</div>
                        <div class="alerta-fecha">@alerta.FechaGeneracion.ToString("dd/MM/yyyy HH:mm")</div>
                    </div>
                </div>
            }
            <div class="text-center mt-3">
                <a href="@Url.Action("Alertas")" class="btn-primary">
                    <i class="fas fa-eye"></i>
                    Ver Todas las Alertas
                </a>
            </div>
        </div>
    }

    <!-- Dashboard Principal -->
    <div class="dashboard-grid">
        <!-- Reportes de Inventario -->
        <div class="dashboard-card">
            <h3>
                <i class="fas fa-boxes card-icon"></i>
                Reportes de Inventario
            </h3>
            <div class="card-description">
                Genera reportes detallados del inventario, stock bajo, movimientos y análisis de productos.
            </div>
            <a href="@Url.Action("Inventario")" class="card-action">
                <i class="fas fa-chart-bar"></i>
                Ver Reporte
            </a>
        </div>

        <!-- Reportes de Préstamos -->
        <div class="dashboard-card">
            <h3>
                <i class="fas fa-hand-holding card-icon"></i>
                Reportes de Préstamos
            </h3>
            <div class="card-description">
                Analiza préstamos activos, devoluciones, retrasos y patrones de uso del material deportivo.
            </div>
            <a href="@Url.Action("Prestamos")" class="card-action">
                <i class="fas fa-chart-line"></i>
                Ver Reporte
            </a>
        </div>

        <!-- Reportes de Sanciones -->
        <div class="dashboard-card">
            <h3>
                <i class="fas fa-exclamation-triangle card-icon"></i>
                Reportes de Sanciones
            </h3>
            <div class="card-description">
                Revisa sanciones activas, montos, tipos y análisis de comportamiento de usuarios.
            </div>
            <a href="@Url.Action("Sanciones")" class="card-action">
                <i class="fas fa-chart-pie"></i>
                Ver Reporte
            </a>
        </div>

        <!-- Plantillas Predefinidas -->
        <div class="dashboard-card">
            <h3>
                <i class="fas fa-file-alt card-icon"></i>
                Plantillas de Reportes
            </h3>
            <div class="card-description">
                Utiliza plantillas predefinidas para generar reportes periódicos de forma rápida y consistente.
            </div>
            <a href="@Url.Action("Plantillas")" class="card-action">
                <i class="fas fa-templates"></i>
                Ver Plantillas
            </a>
        </div>

        <!-- Reportes Personalizados -->
        <div class="dashboard-card">
            <h3>
                <i class="fas fa-cogs card-icon"></i>
                Reportes Personalizados
            </h3>
            <div class="card-description">
                Crea y configura tus propios reportes con filtros, columnas y formatos personalizados.
            </div>
            <a href="@Url.Action("ConfiguracionPersonalizada")" class="card-action">
                <i class="fas fa-sliders-h"></i>
                Configurar
            </a>
        </div>

        <!-- Comparación de Períodos -->
        <div class="dashboard-card">
            <h3>
                <i class="fas fa-balance-scale card-icon"></i>
                Comparación de Períodos
            </h3>
            <div class="card-description">
                Compara datos entre diferentes períodos para analizar tendencias y cambios en el sistema.
            </div>
            <a href="@Url.Action("CompararPeriodos")" class="card-action">
                <i class="fas fa-exchange-alt"></i>
                Comparar
            </a>
        </div>

        <!-- Gráficos Interactivos -->
        <div class="dashboard-card">
            <h3>
                <i class="fas fa-chart-area card-icon"></i>
                Gráficos Interactivos
            </h3>
            <div class="card-description">
                Visualiza datos con gráficos multidimensionales, heatmaps y análisis de actividad de usuarios.
            </div>
            <a href="@Url.Action("GraficosInteractivos")" class="card-action">
                <i class="fas fa-chart-scatter"></i>
                Ver Gráficos
            </a>
        </div>

        <!-- Historial de Aprobaciones -->
        <div class="dashboard-card">
            <h3>
                <i class="fas fa-history card-icon"></i>
                Historial de Aprobaciones
            </h3>
            <div class="card-description">
                Revisa el historial completo de aprobaciones y rechazos de préstamos con estadísticas detalladas.
            </div>
            <a href="@Url.Action("HistorialAprobaciones")" class="card-action">
                <i class="fas fa-clipboard-check"></i>
                Ver Historial
            </a>
        </div>
    </div>

    <!-- Reportes Guardados Recientes -->
    @if (ViewBag.ReportesGuardados != null && ((List<EscuelaFelixArcadio.Models.ReporteGuardado>)ViewBag.ReportesGuardados).Any())
    {
        <div class="reportes-recientes-container">
            <div class="reportes-recientes-header">
                <h3>
                    <i class="fas fa-clock"></i>
                    Reportes Recientes
                </h3>
            </div>
            <div class="reportes-recientes-grid">
                @foreach (var reporte in (List<EscuelaFelixArcadio.Models.ReporteGuardado>)ViewBag.ReportesGuardados)
                {
                    <div class="reporte-reciente-card">
                        <div class="reporte-card-header">
                            <div class="reporte-tipo">
                                @switch (reporte.TipoReporte.ToLower())
                                {
                                    case "inventario":
                                        <i class="fas fa-boxes"></i>
                                        break;
                                    case "prestamos":
                                        <i class="fas fa-hand-holding"></i>
                                        break;
                                    case "sanciones":
                                        <i class="fas fa-exclamation-triangle"></i>
                                        break;
                                    default:
                                        <i class="fas fa-file-alt"></i>
                                        break;
                                }
                            </div>
                            <div class="reporte-formato">
                                <span class="badge badge-@(reporte.Formato == "PDF" ? "danger" : "success")">
                                    @reporte.Formato
                                </span>
                            </div>
                        </div>
                        
                        <div class="reporte-card-body">
                            <h4 class="reporte-nombre">@reporte.NombreReporte</h4>
                            <p class="reporte-tipo-texto">@reporte.TipoReporte</p>
                            <div class="reporte-fecha">
                                <i class="fas fa-calendar-alt"></i>
                                @reporte.FechaGeneracion.ToString("dd/MM/yyyy HH:mm")
                            </div>
                        </div>
                        
                        <div class="reporte-card-footer">
                            <a href="@Url.Action("VerReporte", new { id = reporte.IdReporteGuardado })" class="btn-ver-reporte">
                                <i class="fas fa-eye"></i>
                                Ver Reporte
                            </a>
                        </div>
                    </div>
                }
            </div>
        </div>
    }

    <!-- Estadísticas Generales -->
    <div class="estadisticas-grid" id="estadisticasGenerales">
        <div class="estadistica-card">
            <div class="estadistica-valor" id="totalPrestamos">-</div>
            <div class="estadistica-label">Total Préstamos</div>
        </div>
        <div class="estadistica-card">
            <div class="estadistica-valor" id="prestamosActivos">-</div>
            <div class="estadistica-label">Préstamos Activos</div>
        </div>
        <div class="estadistica-card">
            <div class="estadistica-valor" id="totalSanciones">-</div>
            <div class="estadistica-label">Total Sanciones</div>
        </div>
        <div class="estadistica-card">
            <div class="estadistica-valor" id="alertasCriticas">-</div>
            <div class="estadistica-label">Alertas Críticas</div>
        </div>
        <div class="estadistica-card">
            <div class="estadistica-valor" id="productosStockBajo">-</div>
            <div class="estadistica-label">Stock Bajo</div>
        </div>
    </div>
</div>

@section scripts {
    <script>
        $(document).ready(function() {
            // Cargar estadísticas generales
            cargarEstadisticasGenerales();
            
            // Actualizar estadísticas cada 5 minutos
            setInterval(cargarEstadisticasGenerales, 300000);
        });

        function cargarEstadisticasGenerales() {
            $.get('@Url.Action("EstadisticasGenerales")', function(response) {
                if (response.success) {
                    $('#totalPrestamos').text(response.data.totalPrestamos);
                    $('#prestamosActivos').text(response.data.prestamosActivos);
                    $('#totalSanciones').text(response.data.totalSanciones);
                    $('#alertasCriticas').text(response.data.alertasCriticas);
                    $('#productosStockBajo').text(response.data.productosStockBajo);
                }
            }).fail(function() {
                console.log('Error al cargar estadísticas');
            });
        }
    </script>
}

